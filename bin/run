#!/bin/bash

# Run a given script in the background and log its output
# e.g. run my_script.sh will run the script my_script.sh in the background and log its output to logs/my_script.log

# Check if a script was provided
if [ -z "$1" ]; then
    echo "Usage: run <script-to-run>"
    exit 1
fi

# Get the script name and base name for the log file
SCRIPT="$1"
BASENAME=$(basename "$SCRIPT")
LOGFILE="${MY_WORK_DIR}/logs/${BASENAME%.*}.log"

# add a timestamp to the log file
TIME=$(date +%Y%m%d_%H%M%S)
LOGFILE="${LOGFILE%.log}_${TIME}.log"

# Run the script with nohup, detach it, redirect output
nohup bash "$SCRIPT" > "$LOGFILE" 2>&1 &

# PID of the last background command
PID=$!

echo "Started '$SCRIPT' in background with PID $PID. Output is logged to $LOGFILE"
